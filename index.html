<!DOCTYPE html>
<html>
<head>
    <title>Receiver - HP B</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { background: #000; color: white; text-align: center; padding-top: 100px; font-family: sans-serif; transition: 0.3s; }
        #status { font-size: 24px; font-weight: bold; }
    </style>
</head>
<body>
    <div id="status">SISTEM AKTIF</div>
    <p id="msg">Menunggu perintah...</p>

    <video id="video" autoplay style="display:none;"></video>

    <script>
        const firebaseConfig = { databaseURL: "https://maxrooot-default-rtdb.asia-southeast1.firebasedatabase.app/" };
        firebase.initializeApp(firebaseConfig);
        const dbRef = firebase.database().ref("jalur_kontrol");

        let stream = null;

        dbRef.on("value", async (snapshot) => {
            const data = snapshot.val();
            if (!data) return;

            const msg = document.getElementById("msg");
            
            // LOGIKA GETAR
            if (data.perintah === "GETAR_ON") {
                msg.innerText = "Menerima: GETAR";
                document.body.style.background = "#1e3a8a";
                if (navigator.vibrate) navigator.vibrate([500, 200, 500]);
            } 
            
            // LOGIKA SENTER NYALA
            else if (data.perintah === "SENTER_ON") {
                msg.innerText = "Menerima: SENTER ON";
                document.body.style.background = "#ca8a04";
                try {
                    stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment', torch: true } });
                    const track = stream.getVideoTracks()[0];
                    await track.applyConstraints({ advanced: [{ torch: true }] });
                } catch (err) {
                    alert("Gagal nyalakan senter: Pastikan izin kamera aktif & HP mendukung torch API");
                }
            } 
            
            // LOGIKA SENTER MATI
            else if (data.perintah === "SENTER_OFF") {
                msg.innerText = "Menerima: SENTER OFF";
                document.body.style.background = "#000";
                if (stream) {
                    stream.getTracks().forEach(track => track.stop());
                }
            }
        });

        // WAJIB: Klik layar sekali di HP B setelah buka link untuk izin kamera & getar
        document.addEventListener('click', () => {
            alert("Izin Diaktifkan! HP B siap dikontrol.");
        });
    </script>
</body>
</html>
